{% extends  "myapp/base.html" %}
{% block content %}
<div class="flex p-10 w-full h-200 items-center">
    <img class="w-1/2"src="{{product.image.url}}" alt="">
    <div class="w-2/3 text-xl ml-10 mt-10">
        <div class="mt-5">{{product.name}}</div>
        <div class="mt-5 text-green-500">$ {{product.price}}</div>
        <div class="mt-5 text-gray-700">{{product.desc}}</div>

        <div class="mt-5 text-black"> Posted By : 
            <a href="{% url 'users:sellerprofile' product.seller.id %}" class="text-blue-500">
            {{product.seller}}</a>
        </div>
        <div class="mt-5 text-black flex">Contact : <p class="text-blue-500">{{product.seller.profile.contact_number}}</p>

        </div>
    <div>
        <button class="rounded bg-green-500 text-white px-3 py-2 mt-2" id="checkout">Checkout</button>
    </div>
    </div>
</div> 
    <script src="https://js.stripe.com/v3/"></script>
        <script type="text/javascript">

            var stripe=Stripe('{{stripe_publishable_key}}')
            var checkoutButton=document.getElementById('checkout')
            checkoutButton.addEventListener('click',function(){  
                fetch("{% url 'myapp:api_checkout_session' id=product.id %}",{method:'POST',})
                .then(function(response){
                    return response.json()
                })
                .then(function(session){
                    return stripe.redirectToCheckout({sessionId:session.sessionId})
                })
                .then(function(result){
                    if(result.error){
                        alert(result.error.message)
                    }   
                })
                .catch(function(error){
                    console.error('Error',error)
                })
                
            })
        </script>

 
        
    


{% endblock %}